# 无人驾驶平台介绍和系统安全

## 总复习 PPT 索引

- [传感器平台](#传感器平台)
- [计算平台](#计算平台)
- [控制平台](#控制平台)
- [通信网络协议](#通信网络协议)
- [无人驾驶的安全性](#无人驾驶的安全性)

## 传感器平台

| 传感器       | 成本          | 优势                                         | 劣势                                                 | 功能                                           |
| ------------ | ------------- | -------------------------------------------- | ---------------------------------------------------- | ---------------------------------------------- |
| GPS          | 略            | 相对准确的定位传感器                         | 更新频率低，10Hz                                     | 略                                             |
| IMU          | 略            | 实时性，更新频率 $\ge$ 200Hz                 | 准确度随着时间降低                                   | 与 GPS 基于卡尔曼滤波的传感器融合使用          |
| 激光雷达     | 8000 美元以上 | 扫描周围环境得到精确的环境信息               | 成本高、大雾、雨雪天气效果差，无法图像识别           | 周围环境 3D 建模                               |
| 毫米波雷达   | 300~500 美元  | 不受天气影响，测量精度高，距离范围广         | 无法识别道路指示牌，无法识别行人                     | 无法用于视觉识别，要求较高功能                 |
| 摄像头       | 35~50 美元    | 成本比较低，通过算法可以实现各种功能         | 极端恶劣环境下会失效，难以测距，距离较近，算法要求高 | 能实现大多数 ADAS 功能，测距功能难以实现       |
| V2X          | 150~200 美元  | 不受距离限制，V2X 成本较低，深度融合智能系统 | 精度较低，技术协议仍在讨论中，普及难度大             | 利用通信协议，感知实时路况，道路信息和行人信息 |
| 红外传感器   | 600~2000 美元 | 夜视效果极佳                                 | 成本较高，技术仍由国外垄断                           | 夜视                                           |
| 超声波传感器 | 15~20 美元    | 成本低                                       | 探测距离较近，应用局限大                             | 侧方超车提醒，倒车提醒                         |

> [!NOTE]
> IMU: 惯性测量单元 (Inertial Measurement Unit)  
> ADAS: 高级驾驶辅助系统 (Advanced Driver Assistance Systems)  
> V2X: 车联网 (Vehicle-to-X)  

### 毫米波雷达

1. 检测原理
通过发射无线电信号（毫米波波段的电磁波）并接收反射信号来测定汽车车身周围物理环境信息
2. 优点
毫米波雷达的工作频段为 30～300GHz 毫米波，毫米波的波长为波长为 1～10mm，介于厘米波和光波之间，因此毫米波兼有**微波制导**和**光电制导**的优点。毫米波雷达不受天气状况限制，穿透雾、烟、灰尘的能力强。具有全天候、全天时的工作特性，且探测距离远，探测精度高，被广泛应用于车载距离探测
3. 缺点
   - 相比激光雷达，毫米波雷达精度低、可视范围的角度也偏小
   - 传输的是电磁波信号，因此它无法检测上过漆的木头或是塑料
   - 对金属表面非常敏感
   - 在大桥和隧道里的效果同样不佳
4. 主要频段
24GHz、77GHz

### 激光雷达

1. 检测原理
利用可见和近红外光波（多为 950nm 波段附近的红外光）发射、反射和接收来探测物体
2. 适用性
可以探测白天或黑夜下的特定物体与车之间的距离，由于反射度的不同，也可以区分开车道线和路面。但是无法探测被遮挡的物体、光束无法达到的物体，在雨雪雾天气下性能较差
3. 用途
   - D 建模进行环境感知。
   - SLAM 加强定位
4. 降低价格方法
   - 采用低线数雷达配合其他传感器，但需搭配拥有极高计算能力系统的无人车
   - 采用固态激光雷达。固态激光雷达无需旋转部件，采用电子设备替代。固态激光雷达优点：体积更小，方便集成在车身内部，系统可靠性提高，成本也可大幅降低
5. 局限性
   - 对成本是否能有如此大幅下降抱有疑问
   - 激光特性在大雾等天气仍然并不适用

### 摄像头

1. 优点
    - 成本低
    - 较小数据量获得全面信息
2. 局限性
    - 无法在极端恶劣环境下使用
    - 难以测距
    - 训练样本大，训练周期长，算法要求高

#### 摄像头类型

- **单目摄像头**
  - 一般安装在前挡风玻璃上部，用于探测车辆前方环境，识别道路、车辆、行人等。单目视觉方案的技术难点在于模型机器学习的智能程度或者模式识别的精度
- **后视摄像头**
  - 一般安装在车尾，用于探测车辆后方环境，技术难点在于如何适应不同的恶劣环境
- **立体（双目）摄像头**
  - 依靠两个平行布置的摄像头产生的“视差” ，找到同一个物体所有的点，依赖三角测距，算出摄像头与前方障碍物距离。使用这种方案，需要两个摄像头有较高的同步率和采样率，因此技术难点在于双目标定及双目定位
- **环视摄像头**
  - 一般至少包括四个摄像头，分别安装在车辆前、后、左、右侧，实现 360°环境感知，难点在于畸变还原与对接

### GPS/IMU

略，见表格

### V2X

三大优势
- 覆盖面更广：300~500 米的通信范围，不仅是前方障碍物，身旁和身后的建筑物、车辆都会互相连接，大大拓展了驾驶员的视野范围
- 有效避免盲区：由于所有物体都接入互联网，每个物体都会有单独的信号显示，因此即便是视野受阻，通过实时发送的信号可以显示视野范围内看不到的物体状态。
- 对于隐私信息的安全保护性更好：系统将采用 5.9GHz 频段进行专项通信，相比传统通信技术更能确保安全性和私密性

## 计算平台

### 现有计算解决方案

现有的计算解决方案主要有四种
- DSP
- GPU
- ASIC
- FPGA

#### 基于 GPU 的计算解决方案

GPU 在浮点运算并行计算方面有很高的性能，利用 GPU 运行机器学习模型，在云端进行分类和检测，其相较于 CPU 大大缩短了运行时间，能够支持 10~100 倍的应用吞吐量

#### 基于 DSP 的计算解决方案

特点
- DSP(Digital Singnal Processor) 以数字信号处理大量数据
- DSP 采用**哈佛设计**，允许取出指令和执行指令完全重叠，并进行译码，这大大提高了微处理器的速度
- DSP 允许在程序空间和数据中心之间进行传输，因为增加了器件的灵活性，它具有可编程性，而且实时运行速度可达每秒数以千万条复杂指令程序，远远超过通用微处理器

优势：运算能力很强，速度很快，体积很小，而且采用软件编程具有高度的灵活性

#### 基于 FPGA 的计算解决方案

特点：
FPGA 硬件配置灵活，具有低能耗、高性能及可编程，适合感知计算

优势：
- FPGA 相比 GPU 价格便宜。
- 在能源受限的情况下，FPGA 相对于 CPU 与 GPU 有明显的性能与能耗优势
- 硬件可升级可迭代

#### 基于 ASIC 的计算解决方案

ASIC(Application-Specific Integrated Circuit) 即专用集成电路

特点：为特定任务进行定制化设计、高性能、小体积

优势：计算效率高，能耗相对较低、可靠性高

## 控制平台

控制平台主要包括了电子控制单元 ECU 和通信总线两大部分

- ECU 主要实现控制算法
- 通信总线主要实现 ECU 以及机械部件间的通信功能

### 通信总线

作用：满足各电子系统的实时性要求，对汽车数据实行共享

当前车用总线分为
- A 类总线 (低速网络)：主要用于车内分布式电控系统，尤其是面向智能传感器或执行器的数字话通信场合
- B 类总线 (中速网络)：用于独立控制模块间的信息共享，以 CAN（控制器局域网络）为代表
- C 类总线 (多路传输高速网络)：用于实时性要求较高的场合，如动力传递系统
- D 类总线 (高性能网络)：用于播放机和液晶显示设备

## 通信网络协议

### 局部互联协议 LIN

局部互联协议 LIN 是面向汽车低端分布式应用的低成本低速串行通信总线，可以通过 CAN 网关与汽车其它系统进行信息交换

目标：在不需要 CAN 总线的带宽和多功能的场合使用，为现有的汽车网络提供辅助功能，降低成本

节省成本的原因

- 采用单线传输
- 硅片中硬件或软件的实现成本低
- 无需在从属节点中使用石英或陶瓷谐振器

模式：（一主多从，一对多）单个主控制器，多个从设备

#### LIN 构成

LIN 中含有一个宿主节点和一个或多个从属节点。所有节点都有发送和接收的从属通讯任务，宿主节点包含一个附加的宿主发送任务。实时 LIN 中通讯总是由宿主任务发起的

- 宿主节点发送一个包含同步中断、同步字节和消息识别码的**消息报头**
- 从属任务在收到和过滤识别码后被激活并开始**消息响应**的传输
- 报头和响应部分组成一个消息帧，同一帧可以同时被多个节点接收利用

#### 通信过程

(1) 主机节点的主机任务发起通信，确定当前通讯内容，发送帧头并为报文帧分配帧通道

(2) 总线上的从机节点接收帧头之后，判断是否做出响应、做出何种响应。

主要应用：电动门窗控制、座椅调节、灯光照明

### 控制器局域网 CAN

汽车中控制与测试仪器之间进行数据交换的一种串行数据通讯协议。占据当前汽车总线网络市场的主导地位

分类
- 高速 CAN 最高速度为 1Mbps（C 类总线）
- 低速 CAN 为 250Kbps（B 类总线）

特性：短帧数据结构、非破坏性总线性仲裁技术及灵活的通讯方式

- CAN 总线为线型结构，所有节点并联在总线上。
- CAN 总线是采用 CSMA/CA机制。

CSMA/CA机制:各节点会一直监听总线，发现总线空闲时便开始发送数据。当多个节点同时发送数据时，会通过一套仲裁机制竞争总线(与中断类似)。每个节点会先发送数据的 ID，ID 越小表示优先级越大，优先级大的会自动覆盖小的 ID。当节点发现自己发送的 ID 被覆盖掉时，便自动停止发送。优先级最高的消息获得总线使用权，开始发送数据。当高优先级的数据包发送完后，各节点便又尝试竞争总线。

优势：能最大程度的利用总线

弊端：有时效延迟，优先级越低的数据包，可能需要等待的时间越长

数据出错时：节点发现当前发送的数据有误时，会发送错误帧告知总线上的所有节点。发
送错误数据的节点会重发。每个节点都有一个错误计数器。当一个节点总是发送或接收错
误超过一定次数时，会自动退出总线

### 高速容错网络协议 FlexRay

FlexRay 总线数据收发采取时间触发和事件触发的方式

时间触发通信：网络中的各个节点都预先知道彼此将要进行通信的时间，接收器提前
知道报文到达的时间，报文在总线上的时间可以预测出来

优点：FlexRay 协议可以确保恶劣多变的环境下，干扰了系统传输，也能将信息延
迟和抖动降至最低，尽可能保持传输的同步与可预测

两种周期通信方法
- TDMA
- FTDMA

FlexRay 将通信周期分为：静态部分、动态部分、网络空闲时间

静态部分：常用于发送需要经常性发送的重要性高的数据，使用 TDMA 方法

动态部分：常用于发送使用频率不确定、相对不重要的数据，使用 FTDMA 方法

特点：高速、可靠、安全

## 无人驾驶的安全性

无人驾驶可能受到的攻击有

- **传感器**：针对传感器的攻击不需要进入无人驾驶系统内部，这种外部攻击法技术门槛相当低，既简单又直接
- **无人驾驶操作系统**：如果进入无人驾驶操作系统，黑客可以造成系统崩溃导致停车，也可以窃取车辆敏感信息
- **无人驾驶控制系统**如果进入无人驾驶控制系统，黑客可以直接操控机械部件，劫持无人车去伤人，是极其危险的
- **车联网通信系统**车联网连接不同的无人车，以及中央云平台系统，劫持车联网通信系统也可以造成无人车间的沟通混乱

### 传感器安全

- 惯性传感器 IMU：IMU 辅助无人驾驶定位，但 IMU 对磁场很敏感，如果使用强磁场干
扰 IMU，就有可能影响 IMU 的测量
- GPS：如果在无人车附近设置大功率假 GPS 信号，就可以覆盖原来的真 GPS 信号，从而误导无人车定位
- 轮测距技术：辅助无人车定位，轮测距是通过测量轮子的转速乘与轮子的周长进行测距，如果黑客破坏了轮子，这个定位辅助技术也会受影响
- 激光雷达：无人车依赖于激光雷达数据与高精地图的匹配进行定位。但激光雷达也可以轻易地被干扰。
  - 激光雷达是通过测量激光反射时间来计算深度的。如果在无人车周围放置强反光物，比如镜子，那么激光雷达的测量就会被干扰，返回错误信息。
  - 如果黑客使用激光照射激光雷达，测量也会受干扰。
  - 无人车会不断下载更新的高精地图，如果黑客把下载的地图调包，也会造成定位失效
- 计算机视觉：可以辅助无人车完成许多感知的任务。在交通灯识别的场景中，无人车上的摄像机如果检测到红灯，就会停下来。如果检测到行人，也会停下以免发生意外。黑客可以轻易地在路上放置假的红绿灯以及假的行人，迫使无人车停车并对其进行攻击

应对方法：使用**多传感器融合技术互相纠正**。攻击单个传感器很容易，但是如果同时攻击所有传感器难度相当大。当无人车发现不同传感器的数据相互间不一致，就知道自己可能正在被攻击

### 操作系统安全

ROS 本身安全性有一定问题，总结有以下两种攻击方法：

（1）其中一个 ROS 节点被劫持，然后不断地进行分配内存，导致其系统内存消耗殆尽，造成系统 OOM 而开始关闭不同的 ROS 节点进程，造成整个无人驾驶系统崩溃

原因：ROS 节点本身是一个进程，可以无节制分配资源导致崩溃，另一个原因是 ROS 节点可以访问磁盘以及网络资源，并无很好的隔离机制。

解决方案：（容器技术、沙盒方法）可以使用容器技术（Linux containers，LXC）来管理每一个 ROS 节点进程，限制每一个节点可供使用的资源数。并采用沙盒的方式以确保节点的运行独立，这样以来可最大限度地防止资源泄露

（2）ROS 的话题（topic）或服务（service）被劫持，导致 ROS 节点之间传递的信息被伪造，从而导致无人驾驶系统的异常行为。

原因：通信的信息没有被加密，以至于攻击者可以轻易得知通信内容。

解决方案：目前业界有不少对 ROS 节点间通信的加密尝试，比如使用 DES 加密算法。

缺点：（加密方法）在通信的信息量十分小的时候，加密与否对性能影响不大。但随着信息量变大，加密时间相对信息量成几何级增长。另外，由于 ROS 通信系统的设计缺陷，加密时间也与接收信息的节点数量有直接关系。当接受信息的节点数量增长时，加密时间也随之增长

### 控制系统安全

车辆的 CAN 总线连接着车内的所有机械以及电子控制部件，是车辆的中枢神经

CAN 总线特点：布线简单、典型总线型结构、可最大限度节约布线与维护成本、稳定可靠、实时、抗干扰能力强、传输距离远等。

CAN 总线采用**差分信号传输**，通常情况下只需要两根信号线（CAN-H 和 CAN-L）就可以进行正常的通信。在干扰比较强的场合，还需要用到屏蔽地即 CAN-G（主要功能是屏蔽干扰信号）。

#### 黑客进入 CAN 的攻击方式包括

- **OBD-II 入侵**：OBD-II 端口主要用于检测车辆状态，通常在车辆进行检修时，技术人员会使用每个车厂开发的检测软件接入 OBD-II 端口并对汽车进行检测。由于 OBD-II 连接到 CAN 总线，只要黑客取得检测软件，便能轻易截取车辆信息。
- **电动车充电器入侵**：电动车的充电装置在充电时会与外部充电桩通信，而且电动车的充电装置会连接 CAN 总线，这就给了黑客们通过外部充电桩入侵 CAN 系统的机会。
- **车载 CD 机入侵**：攻击代码编码到音乐 CD 中，当用户播放 CD 时，恶意攻击代码便会通过 CD 播放机侵入 CAN 总线，从而可以取得总线控制以及盗取车辆核心信息。
- **蓝牙入侵**：用户可以通过蓝牙给 CAN 发送信息以及从 CAN 读取信息，这也给黑客们攻击的窗口。除了取得车主手机的控制权，黑客们也可以使用蓝牙进行远程攻击。
- **TPMS 入侵**：TPMS 是车轮压力管理系统。黑客先把攻击代码放置在车辆 TPMS 中，当 TPMS 检测到某个胎压值的时候，恶意代码便会被激活，从而对车辆进行攻击

#### 解决方法

- 对 ECU 接收的信息进行加密验证，以保证信息是由可信的 ECU，而不是由黑客发出

加密验证选择对称或者非对称密码。对称密码的计算量小但是需要通信双方预先知道密码。非对称密码无需预先知道密码，但是计算量大。由于大部分车的 ECU 计算能力与内存有限，现在通用做法是使用对称密码加密，然后密钥在生产过程中被写入 ECU
