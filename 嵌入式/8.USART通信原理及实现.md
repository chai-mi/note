# 通信概述

## 通信分类

### 按数据传送方式分类

- 串行通信：是指通过一根数据线或少量数据线 (少于 8 根) 将数据一位一位地按顺序依次传送
- 并行通信：是指用多条数据线同时传送多位数据，通常以 8 位、16 位、32 位等数据位传送。  

### 按通信数据同步方式分类

- 同步通信
  - 连续串行传送数据的通信方式，要求收发双方的时必须保持严格的同步
  - 特点：传输速率较高
- 异步通信
  - 在发送的有效数据中增加一些用于同步的控制位，比如开始位和停止位等，数据以字符为单位组成数据帧进行传送，收发双方需约定数据的传输速率
  - 特点：传输效率较低，通信设备实现简单、成本低

### 按数据传输方向及与时间的关系

- 单工通信
- 半双工通信
- 全双工通信

## 通信传输速率

- 波特率：  
每秒传输的二进制位数，单位为比特每秒 (bit/s，bps) ，是衡量串行数据传输速度快慢的指标。
- 字符速率：  
每秒所传输的字符数
- **波特率** = 字符速率 × 每个字符包含的位数

**例题**  
字符速率为 120 字符/秒，若每个字符包含 10 位 (1 个起始位，7 个数据位，1 个校验位，1 个结束位) ，则波特率为  
$10 位/字符×120 字符/秒＝1200bps$

# 异步串行通信

**通信传输速率**和**数据帧格式**一起称为**通信协议**

### 异步串行通信标准

- 起始位：占一位，位于数据帧的开头，以逻辑“0”表示传输数据的开始
- 数据位：要发送的数据，数据长度可以是 5～8 位
- 校验位：占一位，用于检测数据是否有效
- 停止位：一帧传送结束的标志，根据实际情况定，可以是 1、1.5 或 2 位
- 空闲位：数据传输完毕，用“1”表示当前线路上没有数据传输

### UART

一个全双工通用异步串行收/发模块，主要用于打印程序调试信息、上位机和下位机的通信以及 ISP 程序下载等场合

### RS-232

串行通信物理接口标准，通常采用 DB-9 或 DB-25 的形式，以 DB-9 最为常见。电气标准采用负逻辑，与 MCU 相连时应电平转换

对可靠性要求不高的场合，DB-9 通常采用三线制串口，仅需发送 (Tx) 、接收 (Rx) 和地 (GND) 三条线，即可实现全双工通信，进行最基本的数据收发传送，最高传输速率可达 20 kbps

# STM32 的 USART 模块

- USART 三部分
  - 数据收发寄存器单元
  - 波特率发生器
  - 发送器/接收器控制单元
- USART 接口
  - STM32F103 大容量产品有 5 个串行通信接口，USART4 和 USART5 为 2 个通用异步收发器，不支持同步模式，只有异步通信功能
  - USART 异步模式至少需要两个引脚：Rx (接收数据引脚) 和 Tx (发送数据引脚) ，使用了复用 I/O 功能

> [!NOTE]
> USART: 同步/异步收发器

# USART 编程模式

### 轮询模式

- 通过定期或循环查询 USART 状态寄存器 SR 各位的状态，编写应用程序对接收或发送的数据进行处理，有两种方式实现对 USART 相关寄存器的操作
  - 寄存器开发方式：在编程代码中直接配置这些功能寄存器
  - 基于库的开发方式：间接对寄存器操作实现相应的 USART 通信功能

### 中断模式

- 发送期间：发送完成、清除发送和发送数据寄存器空
- 接收期间：空闲总线检测、溢出错误、接收数据寄存器非空、校验错误、LIN 断开符号检测、噪音标志 (仅在多缓冲器通信) 和帧错误 (仅在多缓冲器通信)

### DMA 模式

USART 模块可通过 DMA 方式进行大批量数据的连续传输  
STM32F103 微控制器的 USART 的发送和接收分别映射到不同的 DMA 通道上，如：USART1_Rx 被映射到 DMA1 的通道 5，USART1_Tx 被映射到 DMA1 的通道 4

> [!NOTE]
> DMA: 直接存储器访问
